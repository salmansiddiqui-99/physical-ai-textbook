"use strict";(globalThis.webpackChunkphysical_ai_humanoid_robotics=globalThis.webpackChunkphysical_ai_humanoid_robotics||[]).push([[139],{5153:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"module1-ros2/ch2-ros2-humanoids","title":"Chapter 1.2 - ROS 2 for Humanoid Robots","description":"Apply ROS 2 to humanoid robotics with action servers, joint state control, sensor fusion, and multi-controller coordination.","source":"@site/docs/module1-ros2/ch2-ros2-humanoids.md","sourceDirName":"module1-ros2","slug":"/module1-ros2/ch2-ros2-humanoids","permalink":"/physical-ai-textbook/docs/module1-ros2/ch2-ros2-humanoids","draft":false,"unlisted":false,"editUrl":"https://github.com/salmansiddiqui-99/physical-ai-textbook/tree/main/docs/module1-ros2/ch2-ros2-humanoids.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"id":"ch2-ros2-humanoids","title":"Chapter 1.2 - ROS 2 for Humanoid Robots","sidebar_label":"ROS 2 for Humanoids","sidebar_position":2,"description":"Apply ROS 2 to humanoid robotics with action servers, joint state control, sensor fusion, and multi-controller coordination.","keywords":["humanoid robotics","ROS 2 actions","joint state","sensor fusion","ros2_control","IMU"],"prerequisites":["Chapter 1.1 completed (ROS 2 nodes, topics, services)","Understanding of robotic kinematics (joints, links)","Familiarity with PID control basics"],"learning_objectives":["Implement ROS 2 action servers for long-running humanoid behaviors","Publish and subscribe to joint state and command messages","Integrate IMU and force sensor data into ROS 2 control loops","Coordinate multiple controllers for locomotion and manipulation"],"estimated_time":"120 minutes"},"sidebar":"tutorialSidebar","previous":{"title":"ROS 2 Fundamentals","permalink":"/physical-ai-textbook/docs/module1-ros2/ch1-ros2-basics"},"next":{"title":"URDF for Humanoids","permalink":"/physical-ai-textbook/docs/module1-ros2/ch3-urdf-humanoids"}}');var t=r(4848),o=r(8453);const i={id:"ch2-ros2-humanoids",title:"Chapter 1.2 - ROS 2 for Humanoid Robots",sidebar_label:"ROS 2 for Humanoids",sidebar_position:2,description:"Apply ROS 2 to humanoid robotics with action servers, joint state control, sensor fusion, and multi-controller coordination.",keywords:["humanoid robotics","ROS 2 actions","joint state","sensor fusion","ros2_control","IMU"],prerequisites:["Chapter 1.1 completed (ROS 2 nodes, topics, services)","Understanding of robotic kinematics (joints, links)","Familiarity with PID control basics"],learning_objectives:["Implement ROS 2 action servers for long-running humanoid behaviors","Publish and subscribe to joint state and command messages","Integrate IMU and force sensor data into ROS 2 control loops","Coordinate multiple controllers for locomotion and manipulation"],estimated_time:"120 minutes"},a="Chapter 1.2 - ROS 2 for Humanoid Robots",l={},c=[{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Introduction",id:"introduction",level:2},{value:"Section 1: Actions for Goal-Based Behaviors",id:"section-1-actions-for-goal-based-behaviors",level:2},{value:"Subsection 1.1: Action Anatomy",id:"subsection-11-action-anatomy",level:3},{value:"Subsection 1.2: When to Use Actions vs. Services",id:"subsection-12-when-to-use-actions-vs-services",level:3},{value:"Section 2: Implementing a Humanoid Action Server",id:"section-2-implementing-a-humanoid-action-server",level:2},{value:"Example: Walk Forward Action Server",id:"example-walk-forward-action-server",level:3},{value:"Section 3: Joint State Management",id:"section-3-joint-state-management",level:2},{value:"Subsection 3.1: JointState Messages",id:"subsection-31-jointstate-messages",level:3},{value:"Subsection 3.2: Publishing Joint States",id:"subsection-32-publishing-joint-states",level:3},{value:"Section 4: IMU and Force Sensor Integration",id:"section-4-imu-and-force-sensor-integration",level:2},{value:"Subsection 4.1: IMU Data in ROS 2",id:"subsection-41-imu-data-in-ros-2",level:3},{value:"Example: IMU-Based Balance Monitor",id:"example-imu-based-balance-monitor",level:3},{value:"Section 5: ros2_control Framework",id:"section-5-ros2_control-framework",level:2},{value:"Subsection 5.1: Controller Manager Architecture",id:"subsection-51-controller-manager-architecture",level:3},{value:"Subsection 5.2: Loading Controllers",id:"subsection-52-loading-controllers",level:3},{value:"Hands-On Project: Humanoid Balance Controller",id:"hands-on-project-humanoid-balance-controller",level:2},{value:"Step 1: Set Up IMU Publisher (Simulated)",id:"step-1-set-up-imu-publisher-simulated",level:3},{value:"Step 2: Create Balance Controller",id:"step-2-create-balance-controller",level:3},{value:"Step 3: Run and Test",id:"step-3-run-and-test",level:3},{value:"Challenge: Test Your Understanding",id:"challenge-test-your-understanding",level:2},{value:"Summary",id:"summary",level:2},{value:"Further Reading",id:"further-reading",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(n){const e={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"chapter-12---ros-2-for-humanoid-robots",children:"Chapter 1.2 - ROS 2 for Humanoid Robots"})}),"\n",(0,t.jsx)(e.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,t.jsx)(e.p,{children:"By the end of this chapter, you will be able to:"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:'Implement ROS 2 action servers to execute goal-based behaviors like "walk forward 2 meters"'}),"\n",(0,t.jsxs)(e.li,{children:["Publish and subscribe to ",(0,t.jsx)(e.code,{children:"sensor_msgs/JointState"})," for controlling humanoid joints"]}),"\n",(0,t.jsxs)(e.li,{children:["Integrate IMU data (",(0,t.jsx)(e.code,{children:"sensor_msgs/Imu"}),") for balance and orientation feedback"]}),"\n",(0,t.jsxs)(e.li,{children:["Design multi-controller architectures using ",(0,t.jsx)(e.code,{children:"ros2_control"})," for coordinating locomotion and manipulation"]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsx)(e.p,{children:"Before starting this chapter, you should:"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Have completed ",(0,t.jsx)(e.a,{href:"/physical-ai-textbook/docs/module1-ros2/ch1-ros2-basics",children:"Chapter 1.1: ROS 2 Fundamentals"})," (nodes, topics, services)"]}),"\n",(0,t.jsx)(e.li,{children:"Understand robotic kinematics basics (revolute/prismatic joints, coordinate frames)"}),"\n",(0,t.jsxs)(e.li,{children:["Have ROS 2 Humble installed with ",(0,t.jsx)(e.code,{children:"ros-humble-ros2-control"})," and ",(0,t.jsx)(e.code,{children:"ros-humble-controller-manager"})]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"introduction",children:"Introduction"}),"\n",(0,t.jsx)(e.p,{children:"Humanoid robots present unique control challenges compared to wheeled or industrial robots. With 20-40+ degrees of freedom, multiple contact points (feet, hands), and the constant need to maintain balance, humanoid control requires sophisticated coordination across many subsystems."}),"\n",(0,t.jsxs)(e.p,{children:["ROS 2 provides the infrastructure for this complexity through ",(0,t.jsx)(e.strong,{children:"actions"})," (goal-based behaviors), ",(0,t.jsx)(e.strong,{children:"joint state management"}),", and ",(0,t.jsx)(e.strong,{children:"controller interfaces"}),". In this chapter, you'll learn how to apply ROS 2 to humanoid-specific problems: walking controllers, balance feedback from IMUs, force sensing for contact detection, and coordinating arm and leg movements simultaneously."]}),"\n",(0,t.jsx)(e.p,{children:'By the end of this chapter, you\'ll build a simulated humanoid controller that can receive high-level commands ("walk forward"), execute them using action servers, and provide real-time feedback on joint positions and sensor states\u2014the foundation for full humanoid autonomy.'}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"section-1-actions-for-goal-based-behaviors",children:"Section 1: Actions for Goal-Based Behaviors"}),"\n",(0,t.jsxs)(e.p,{children:["While ",(0,t.jsx)(e.strong,{children:"services"})," provide request-response communication, many humanoid tasks are ",(0,t.jsx)(e.strong,{children:"long-running"})," and require ",(0,t.jsx)(e.strong,{children:"feedback"}),' during execution. For example, "walk to waypoint (2, 0)" might take 10 seconds and should report progress every 100ms. ROS 2 ',(0,t.jsx)(e.strong,{children:"actions"})," are designed for exactly this pattern."]}),"\n",(0,t.jsx)(e.h3,{id:"subsection-11-action-anatomy",children:"Subsection 1.1: Action Anatomy"}),"\n",(0,t.jsx)(e.p,{children:"A ROS 2 action consists of three message types:"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Goal"}),": The desired behavior (e.g., ",(0,t.jsx)(e.code,{children:"target_pose"}),", ",(0,t.jsx)(e.code,{children:"distance_to_walk"}),")"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Feedback"}),": Periodic status updates (e.g., ",(0,t.jsx)(e.code,{children:"current_pose"}),", ",(0,t.jsx)(e.code,{children:"percentage_complete"}),")"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Result"}),": Final outcome when the action completes (e.g., ",(0,t.jsx)(e.code,{children:"success"}),", ",(0,t.jsx)(e.code,{children:"final_error"}),")"]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:"Actions support:"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Cancellation"}),": Client can abort long-running actions"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Feedback"}),": Server sends progress updates during execution"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Asynchronous execution"}),": Multiple goals can be queued"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"subsection-12-when-to-use-actions-vs-services",children:"Subsection 1.2: When to Use Actions vs. Services"}),"\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"Use Case"}),(0,t.jsx)(e.th,{children:"Mechanism"}),(0,t.jsx)(e.th,{children:"Example"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Instant response, no progress"}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.strong,{children:"Service"})}),(0,t.jsx)(e.td,{children:'"Get current joint angles"'})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Long-running task with feedback"}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.strong,{children:"Action"})}),(0,t.jsx)(e.td,{children:'"Walk 5 meters forward" (10+ seconds)'})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Continuous data stream"}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.strong,{children:"Topic"})}),(0,t.jsx)(e.td,{children:"IMU readings at 100 Hz"})]})]})]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Key Terminology"}),":"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Action Server"}),": Node that executes the long-running task and publishes feedback"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Action Client"}),": Node that sends goals and receives feedback/results"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Goal Handle"}),": Reference to a specific action goal for tracking and cancellation"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Feedback Callback"}),": Function called periodically as action progresses"]}),"\n"]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"section-2-implementing-a-humanoid-action-server",children:"Section 2: Implementing a Humanoid Action Server"}),"\n",(0,t.jsx)(e.p,{children:'Let\'s build an action server for a humanoid "walk forward" behavior. This demonstrates how to structure goal-based locomotion commands.'}),"\n",(0,t.jsx)(e.h3,{id:"example-walk-forward-action-server",children:"Example: Walk Forward Action Server"}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Purpose"}),": Accept distance goals and simulate walking behavior with feedback."]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Environment"}),": ROS 2 Humble"]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Dependencies"}),":"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"source /opt/ros/humble/setup.bash\r\n\r\n# Install action interfaces (included with ROS 2)\r\nsudo apt install ros-humble-example-interfaces\r\n\r\n# For custom actions (covered later):\r\n# sudo apt install ros-humble-action-msgs\n"})}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Action Definition"}),":"]}),"\n",(0,t.jsxs)(e.p,{children:["We'll use a custom action definition. Create ",(0,t.jsx)(e.code,{children:"WalkForward.action"}),":"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"# Goal: Distance to walk in meters\r\nfloat32 distance\r\n---\r\n# Result: Whether walk completed successfully\r\nbool success\r\nfloat32 distance_traveled\r\n---\r\n# Feedback: Current progress\r\nfloat32 current_distance\r\nfloat32 percentage_complete\n"})}),"\n",(0,t.jsxs)(e.p,{children:["For this example, we'll simulate using the built-in ",(0,t.jsx)(e.code,{children:"fibonacci"})," action pattern. In production, you'd build and install custom actions in a ROS 2 package."]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Action Server Code"}),":"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:'#!/usr/bin/env python3\r\n"""\r\nHumanoid Walk Forward Action Server\r\n\r\nPurpose: Execute "walk forward" goals with real-time feedback\r\nAction: custom_interfaces/action/WalkForward (simplified as example here)\r\n"""\r\n\r\nimport time\r\nimport rclpy\r\nfrom rclpy.action import ActionServer\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.action import Fibonacci  # Using as a placeholder\r\nfrom geometry_msgs.msg import Twist\r\n\r\n\r\nclass WalkForwardActionServer(Node):\r\n    """\r\n    Action server that simulates a humanoid walking forward.\r\n\r\n    In a real robot, this would:\r\n    1. Send joint trajectories to leg controllers\r\n    2. Monitor foot contact sensors\r\n    3. Adjust gait based on IMU feedback\r\n    4. Publish odometry updates\r\n    """\r\n\r\n    def __init__(self):\r\n        super().__init__(\'walk_forward_action_server\')\r\n\r\n        # Create action server\r\n        self._action_server = ActionServer(\r\n            self,\r\n            Fibonacci,  # Placeholder; use WalkForward in production\r\n            \'walk_forward\',\r\n            self.execute_callback\r\n        )\r\n\r\n        # Publisher for velocity commands (would go to locomotion controller)\r\n        self.cmd_vel_pub = self.create_publisher(Twist, \'/cmd_vel\', 10)\r\n\r\n        self.get_logger().info(\'Walk Forward Action Server started\')\r\n\r\n    def execute_callback(self, goal_handle):\r\n        """\r\n        Execute the walk forward action.\r\n\r\n        Args:\r\n            goal_handle: Handle for this action goal\r\n\r\n        Returns:\r\n            Result message when action completes\r\n        """\r\n        self.get_logger().info(\'Executing walk forward action...\')\r\n\r\n        # In real robot: goal_handle.request.distance\r\n        target_distance = 2.0  # meters\r\n        current_distance = 0.0\r\n        step_distance = 0.1  # Simulate 0.1m progress per iteration\r\n        feedback_msg = Fibonacci.Feedback()\r\n\r\n        # Simulate walking with periodic feedback\r\n        while current_distance < target_distance:\r\n            # Check if action was canceled\r\n            if goal_handle.is_cancel_requested:\r\n                goal_handle.canceled()\r\n                self.get_logger().info(\'Action canceled\')\r\n                return Fibonacci.Result()\r\n\r\n            # Simulate walking progress\r\n            current_distance += step_distance\r\n            percentage = (current_distance / target_distance) * 100\r\n\r\n            # Publish feedback\r\n            feedback_msg.sequence = [int(current_distance * 10)]  # Placeholder\r\n            goal_handle.publish_feedback(feedback_msg)\r\n\r\n            # Log progress\r\n            self.get_logger().info(f\'Progress: {current_distance:.2f}m / {target_distance:.2f}m ({percentage:.1f}%)\')\r\n\r\n            # Send velocity command to locomotion controller\r\n            cmd = Twist()\r\n            cmd.linear.x = 0.2  # 0.2 m/s forward\r\n            self.cmd_vel_pub.publish(cmd)\r\n\r\n            time.sleep(0.5)  # 2 Hz update rate\r\n\r\n        # Action completed successfully\r\n        goal_handle.succeed()\r\n\r\n        # Stop robot\r\n        stop_cmd = Twist()\r\n        self.cmd_vel_pub.publish(stop_cmd)\r\n\r\n        result = Fibonacci.Result()\r\n        result.sequence = [int(target_distance * 10)]  # Placeholder\r\n        self.get_logger().info(\'Walk forward action completed!\')\r\n\r\n        return result\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = WalkForwardActionServer()\r\n\r\n    try:\r\n        rclpy.spin(node)\r\n    except KeyboardInterrupt:\r\n        pass\r\n\r\n    node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Code Explanation"}),":"]}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Lines 30-35"}),": ",(0,t.jsx)(e.code,{children:"ActionServer()"})," creates an action server with a callback that executes when goals are received. The callback runs in a separate thread, allowing the node to handle multiple concurrent actions."]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Lines 53-58"}),": We check ",(0,t.jsx)(e.code,{children:"goal_handle.is_cancel_requested"})," periodically to support cancellation. If the client cancels, we stop execution and return early."]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Lines 61-67"}),": Feedback is published using ",(0,t.jsx)(e.code,{children:"goal_handle.publish_feedback()"}),". In a real humanoid, this would include current odometry, joint states, and contact sensor status."]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Lines 69-72"}),": We publish ",(0,t.jsx)(e.code,{children:"Twist"})," messages to ",(0,t.jsx)(e.code,{children:"/cmd_vel"}),", which a locomotion controller would use to generate joint trajectories. In simulation (Gazebo/Isaac), this topic directly controls the robot's motion."]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Lines 77-82"}),": When the goal is reached, we call ",(0,t.jsx)(e.code,{children:"goal_handle.succeed()"})," and return a result message. The action client receives this and knows the behavior completed."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Action Client Code"}),":"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:'#!/usr/bin/env python3\r\n"""\r\nHumanoid Walk Forward Action Client\r\n\r\nPurpose: Send walk forward goals to the action server\r\n"""\r\n\r\nimport rclpy\r\nfrom rclpy.action import ActionClient\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.action import Fibonacci\r\n\r\n\r\nclass WalkForwardActionClient(Node):\r\n    """Action client for sending walk forward commands."""\r\n\r\n    def __init__(self):\r\n        super().__init__(\'walk_forward_action_client\')\r\n        self._action_client = ActionClient(self, Fibonacci, \'walk_forward\')\r\n\r\n    def send_goal(self, distance):\r\n        """Send a walk forward goal."""\r\n        goal_msg = Fibonacci.Goal()\r\n        goal_msg.order = int(distance * 10)  # Placeholder encoding\r\n\r\n        self.get_logger().info(f\'Sending goal: Walk {distance}m forward\')\r\n\r\n        # Wait for action server\r\n        self._action_client.wait_for_server()\r\n\r\n        # Send goal and register callbacks\r\n        send_goal_future = self._action_client.send_goal_async(\r\n            goal_msg,\r\n            feedback_callback=self.feedback_callback\r\n        )\r\n\r\n        send_goal_future.add_done_callback(self.goal_response_callback)\r\n\r\n    def goal_response_callback(self, future):\r\n        """Handle server\'s acceptance/rejection of goal."""\r\n        goal_handle = future.result()\r\n\r\n        if not goal_handle.accepted:\r\n            self.get_logger().info(\'Goal rejected by server\')\r\n            return\r\n\r\n        self.get_logger().info(\'Goal accepted, waiting for result...\')\r\n\r\n        # Wait for action to complete\r\n        result_future = goal_handle.get_result_async()\r\n        result_future.add_done_callback(self.result_callback)\r\n\r\n    def feedback_callback(self, feedback_msg):\r\n        """Called periodically as action progresses."""\r\n        feedback = feedback_msg.feedback\r\n        self.get_logger().info(f\'Feedback: {feedback.sequence}\')\r\n\r\n    def result_callback(self, future):\r\n        """Called when action completes."""\r\n        result = future.result().result\r\n        self.get_logger().info(f\'Action completed! Result: {result.sequence}\')\r\n        rclpy.shutdown()\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = WalkForwardActionClient()\r\n\r\n    # Send goal: walk 2 meters forward\r\n    node.send_goal(2.0)\r\n\r\n    rclpy.spin(node)\r\n\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Running the Action"}),":"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# Terminal 1: Start action server\r\nsource /opt/ros/humble/setup.bash\r\npython3 walk_action_server.py\r\n\r\n# Terminal 2: Send goal from client\r\nsource /opt/ros/humble/setup.bash\r\npython3 walk_action_client.py\r\n\r\n# Terminal 3: Monitor cmd_vel output\r\nsource /opt/ros/humble/setup.bash\r\nros2 topic echo /cmd_vel\n"})}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Expected Output"}),":"]}),"\n",(0,t.jsx)(e.p,{children:"Server terminal:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"[INFO] [walk_forward_action_server]: Walk Forward Action Server started\r\n[INFO] [walk_forward_action_server]: Executing walk forward action...\r\n[INFO] [walk_forward_action_server]: Progress: 0.10m / 2.00m (5.0%)\r\n[INFO] [walk_forward_action_server]: Progress: 0.20m / 2.00m (10.0%)\r\n...\r\n[INFO] [walk_forward_action_server]: Walk forward action completed!\n"})}),"\n",(0,t.jsx)(e.p,{children:"Client terminal:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"[INFO] [walk_forward_action_client]: Sending goal: Walk 2.0m forward\r\n[INFO] [walk_forward_action_client]: Goal accepted, waiting for result...\r\n[INFO] [walk_forward_action_client]: Feedback: [1]\r\n[INFO] [walk_forward_action_client]: Feedback: [2]\r\n...\r\n[INFO] [walk_forward_action_client]: Action completed! Result: [20]\n"})}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Troubleshooting"}),":"]}),"\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"Issue"}),(0,t.jsx)(e.th,{children:"Solution"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:'"Action server not available"'}),(0,t.jsxs)(e.td,{children:["Ensure server is running before starting client; check action name matches (",(0,t.jsx)(e.code,{children:"walk_forward"}),")"]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"No feedback received"}),(0,t.jsxs)(e.td,{children:["Verify ",(0,t.jsx)(e.code,{children:"feedback_callback"})," is registered in ",(0,t.jsx)(e.code,{children:"send_goal_async()"})]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Action doesn't cancel"}),(0,t.jsxs)(e.td,{children:["Implement proper cancellation handling in ",(0,t.jsx)(e.code,{children:"execute_callback"})]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Multiple goals interfere"}),(0,t.jsxs)(e.td,{children:["Use ",(0,t.jsx)(e.code,{children:"ServerGoalHandle"})," to track individual goals independently"]})]})]})]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"section-3-joint-state-management",children:"Section 3: Joint State Management"}),"\n",(0,t.jsx)(e.p,{children:"Humanoid robots have dozens of joints (ankles, knees, hips, shoulders, elbows, etc.). ROS 2 provides standard interfaces for publishing and commanding these joints."}),"\n",(0,t.jsx)(e.h3,{id:"subsection-31-jointstate-messages",children:"Subsection 3.1: JointState Messages"}),"\n",(0,t.jsxs)(e.p,{children:["The ",(0,t.jsx)(e.code,{children:"sensor_msgs/JointState"})," message represents the current state of all robot joints:"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:'# Joint names (e.g., ["left_hip_pitch", "left_knee", "right_hip_pitch", ...])\r\nstring[] name\r\n\r\n# Joint positions in radians (revolute) or meters (prismatic)\r\nfloat64[] position\r\n\r\n# Joint velocities (rad/s or m/s)\r\nfloat64[] velocity\r\n\r\n# Joint efforts (torque in N\u22c5m or force in N)\r\nfloat64[] effort\r\n\r\n# Header with timestamp\r\nstd_msgs/Header header\n'})}),"\n",(0,t.jsx)(e.h3,{id:"subsection-32-publishing-joint-states",children:"Subsection 3.2: Publishing Joint States"}),"\n",(0,t.jsx)(e.p,{children:"Here's a simple joint state publisher for a 2-DOF leg:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:'#!/usr/bin/env python3\r\n"""\r\nHumanoid Joint State Publisher\r\n\r\nPurpose: Publish joint states for a simple 2-DOF leg (hip and knee)\r\nOutputs: sensor_msgs/JointState messages on /joint_states\r\n"""\r\n\r\nimport math\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom sensor_msgs.msg import JointState\r\nfrom std_msgs.msg import Header\r\n\r\n\r\nclass JointStatePublisher(Node):\r\n    """Publishes simulated joint states for a humanoid leg."""\r\n\r\n    def __init__(self):\r\n        super().__init__(\'joint_state_publisher\')\r\n\r\n        self.publisher_ = self.create_publisher(JointState, \'/joint_states\', 10)\r\n        self.timer = self.create_timer(0.01, self.publish_joint_states)  # 100 Hz\r\n\r\n        self.time_sec = 0.0\r\n        self.get_logger().info(\'Joint State Publisher started (100 Hz)\')\r\n\r\n    def publish_joint_states(self):\r\n        """Publish current joint positions, velocities, and efforts."""\r\n        msg = JointState()\r\n        msg.header = Header()\r\n        msg.header.stamp = self.get_clock().now().to_msg()\r\n\r\n        # Joint names (must match URDF)\r\n        msg.name = [\'left_hip_pitch\', \'left_knee\']\r\n\r\n        # Simulate sinusoidal joint motion (walking gait)\r\n        hip_angle = 0.5 * math.sin(2 * math.pi * 0.5 * self.time_sec)  # \xb10.5 rad\r\n        knee_angle = 0.8 * math.sin(2 * math.pi * 0.5 * self.time_sec + math.pi/4)\r\n\r\n        msg.position = [hip_angle, knee_angle]\r\n\r\n        # Calculate velocities (derivative of position)\r\n        msg.velocity = [\r\n            0.5 * 2 * math.pi * 0.5 * math.cos(2 * math.pi * 0.5 * self.time_sec),\r\n            0.8 * 2 * math.pi * 0.5 * math.cos(2 * math.pi * 0.5 * self.time_sec + math.pi/4)\r\n        ]\r\n\r\n        # Simulate joint torques (efforts)\r\n        msg.effort = [10.0, 5.0]  # N\u22c5m\r\n\r\n        self.publisher_.publish(msg)\r\n        self.time_sec += 0.01  # Increment time\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = JointStatePublisher()\r\n\r\n    try:\r\n        rclpy.spin(node)\r\n    except KeyboardInterrupt:\r\n        pass\r\n\r\n    node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Running and Visualizing"}),":"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# Terminal 1: Publish joint states\r\npython3 joint_state_publisher.py\r\n\r\n# Terminal 2: Echo joint states\r\nros2 topic echo /joint_states --once\r\n\r\n# Terminal 3: Plot joint positions in real-time (requires plotjuggler)\r\nsudo apt install ros-humble-plotjuggler-ros\r\nros2 run plotjuggler plotjuggler\n"})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"section-4-imu-and-force-sensor-integration",children:"Section 4: IMU and Force Sensor Integration"}),"\n",(0,t.jsxs)(e.p,{children:["Humanoid robots rely on ",(0,t.jsx)(e.strong,{children:"Inertial Measurement Units (IMUs)"})," for balance and ",(0,t.jsx)(e.strong,{children:"force sensors"})," in feet for contact detection."]}),"\n",(0,t.jsx)(e.h3,{id:"subsection-41-imu-data-in-ros-2",children:"Subsection 4.1: IMU Data in ROS 2"}),"\n",(0,t.jsxs)(e.p,{children:["The ",(0,t.jsx)(e.code,{children:"sensor_msgs/Imu"})," message contains:"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Orientation"})," (quaternion): Roll, pitch, yaw angles"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Angular velocity"})," (rad/s): Rotation rates around x, y, z axes"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Linear acceleration"})," (m/s\xb2): Acceleration in x, y, z directions"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"example-imu-based-balance-monitor",children:"Example: IMU-Based Balance Monitor"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:'#!/usr/bin/env python3\r\n"""\r\nHumanoid IMU Balance Monitor\r\n\r\nPurpose: Subscribe to IMU data and detect balance loss\r\nInputs: sensor_msgs/Imu messages on /imu/data\r\nOutputs: Warnings when tilt exceeds safe thresholds\r\n"""\r\n\r\nimport math\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom sensor_msgs.msg import Imu\r\n\r\n\r\nclass BalanceMonitor(Node):\r\n    """Monitors IMU data to detect dangerous tilt angles."""\r\n\r\n    def __init__(self):\r\n        super().__init__(\'balance_monitor\')\r\n\r\n        self.subscription = self.create_subscription(\r\n            Imu,\r\n            \'/imu/data\',\r\n            self.imu_callback,\r\n            10\r\n        )\r\n\r\n        # Balance thresholds (radians)\r\n        self.max_pitch = math.radians(15)  # 15 degrees forward/backward\r\n        self.max_roll = math.radians(10)   # 10 degrees left/right\r\n\r\n        self.get_logger().info(\'Balance Monitor started\')\r\n\r\n    def imu_callback(self, msg):\r\n        """Process IMU data and check balance."""\r\n        # Extract quaternion\r\n        qx = msg.orientation.x\r\n        qy = msg.orientation.y\r\n        qz = msg.orientation.z\r\n        qw = msg.orientation.w\r\n\r\n        # Convert quaternion to Euler angles (roll, pitch, yaw)\r\n        roll = math.atan2(2*(qw*qx + qy*qz), 1 - 2*(qx**2 + qy**2))\r\n        pitch = math.asin(2*(qw*qy - qz*qx))\r\n        yaw = math.atan2(2*(qw*qz + qx*qy), 1 - 2*(qy**2 + qz**2))\r\n\r\n        # Check balance thresholds\r\n        if abs(pitch) > self.max_pitch:\r\n            self.get_logger().warn(\r\n                f\'BALANCE WARNING: Pitch angle {math.degrees(pitch):.1f}\xb0 exceeds safe limit!\'\r\n            )\r\n\r\n        if abs(roll) > self.max_roll:\r\n            self.get_logger().warn(\r\n                f\'BALANCE WARNING: Roll angle {math.degrees(roll):.1f}\xb0 exceeds safe limit!\'\r\n            )\r\n\r\n        # Log angular velocity (for fall detection)\r\n        angular_vel = msg.angular_velocity\r\n        total_rotation_rate = math.sqrt(\r\n            angular_vel.x**2 + angular_vel.y**2 + angular_vel.z**2\r\n        )\r\n\r\n        if total_rotation_rate > 3.0:  # rad/s\r\n            self.get_logger().warn(\r\n                f\'RAPID ROTATION DETECTED: {total_rotation_rate:.2f} rad/s\'\r\n            )\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = BalanceMonitor()\r\n\r\n    try:\r\n        rclpy.spin(node)\r\n    except KeyboardInterrupt:\r\n        pass\r\n\r\n    node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Testing with Simulated IMU Data"}),":"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:'# Terminal 1: Start balance monitor\r\npython3 balance_monitor.py\r\n\r\n# Terminal 2: Publish test IMU data\r\nros2 topic pub /imu/data sensor_msgs/msg/Imu "{\r\n  orientation: {x: 0.1, y: 0.2, z: 0.0, w: 0.975},\r\n  angular_velocity: {x: 0.0, y: 0.0, z: 0.5},\r\n  linear_acceleration: {x: 0.0, y: 0.0, z: 9.81}\r\n}"\n'})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"section-5-ros2_control-framework",children:"Section 5: ros2_control Framework"}),"\n",(0,t.jsxs)(e.p,{children:["The ",(0,t.jsx)(e.code,{children:"ros2_control"})," framework provides a standardized interface for managing robot controllers. It's used by humanoid platforms like PAL Robotics' TALOS and Agility Robotics' Digit."]}),"\n",(0,t.jsx)(e.h3,{id:"subsection-51-controller-manager-architecture",children:"Subsection 5.1: Controller Manager Architecture"}),"\n",(0,t.jsxs)(e.p,{children:["The ",(0,t.jsx)(e.strong,{children:"Controller Manager"})," loads and manages multiple controllers:"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Joint Trajectory Controller"}),": Executes smooth joint motions"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Joint State Broadcaster"}),": Publishes current joint states"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Diff Drive Controller"}),": For wheeled bases (if applicable)"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Admittance Controller"}),": For force-controlled manipulation"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"subsection-52-loading-controllers",children:"Subsection 5.2: Loading Controllers"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# List available controllers\r\nros2 control list_controllers\r\n\r\n# Load joint trajectory controller\r\nros2 control load_controller joint_trajectory_controller\r\n\r\n# Start controller\r\nros2 control switch_controllers --start joint_trajectory_controller\r\n\r\n# Send trajectory commands\r\nros2 topic pub /joint_trajectory_controller/joint_trajectory \\\r\n  trajectory_msgs/msg/JointTrajectory \\\r\n  \"{joint_names: ['left_hip_pitch', 'left_knee'], ...}\"\n"})}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"hands-on-project-humanoid-balance-controller",children:"Hands-On Project: Humanoid Balance Controller"}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Goal"}),": Build a system that monitors IMU data and adjusts ankle joint positions to maintain balance."]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Duration"}),": 45 minutes"]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"What You'll Learn"}),":"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Integrating IMU feedback into control loops"}),"\n",(0,t.jsx)(e.li,{children:"Commanding joint positions based on sensor data"}),"\n",(0,t.jsx)(e.li,{children:"Using actions for high-level behaviors"}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"step-1-set-up-imu-publisher-simulated",children:"Step 1: Set Up IMU Publisher (Simulated)"}),"\n",(0,t.jsxs)(e.p,{children:["Create ",(0,t.jsx)(e.code,{children:"imu_simulator.py"}),":"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:"#!/usr/bin/env python3\r\nimport math\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom sensor_msgs.msg import Imu\r\nimport random\r\n\r\n\r\nclass IMUSimulator(Node):\r\n    def __init__(self):\r\n        super().__init__('imu_simulator')\r\n        self.publisher_ = self.create_publisher(Imu, '/imu/data', 10)\r\n        self.timer = self.create_timer(0.01, self.publish_imu)\r\n        self.time = 0.0\r\n\r\n    def publish_imu(self):\r\n        msg = Imu()\r\n        msg.header.stamp = self.get_clock().now().to_msg()\r\n        msg.header.frame_id = 'imu_link'\r\n\r\n        # Simulate slight tilt with noise\r\n        pitch = 0.1 * math.sin(self.time) + random.uniform(-0.05, 0.05)\r\n\r\n        # Simplified quaternion (pitch rotation only)\r\n        msg.orientation.x = 0.0\r\n        msg.orientation.y = math.sin(pitch / 2)\r\n        msg.orientation.z = 0.0\r\n        msg.orientation.w = math.cos(pitch / 2)\r\n\r\n        msg.angular_velocity.x = 0.0\r\n        msg.angular_velocity.y = 0.1 * math.cos(self.time)\r\n        msg.angular_velocity.z = 0.0\r\n\r\n        msg.linear_acceleration.x = 0.0\r\n        msg.linear_acceleration.y = 0.0\r\n        msg.linear_acceleration.z = 9.81\r\n\r\n        self.publisher_.publish(msg)\r\n        self.time += 0.01\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = IMUSimulator()\r\n    rclpy.spin(node)\r\n    node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,t.jsx)(e.h3,{id:"step-2-create-balance-controller",children:"Step 2: Create Balance Controller"}),"\n",(0,t.jsxs)(e.p,{children:["Create ",(0,t.jsx)(e.code,{children:"balance_controller.py"}),":"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:"#!/usr/bin/env python3\r\nimport math\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom sensor_msgs.msg import Imu, JointState\r\n\r\n\r\nclass BalanceController(Node):\r\n    def __init__(self):\r\n        super().__init__('balance_controller')\r\n\r\n        # Subscribe to IMU\r\n        self.imu_sub = self.create_subscription(\r\n            Imu,\r\n            '/imu/data',\r\n            self.imu_callback,\r\n            10\r\n        )\r\n\r\n        # Publish joint commands\r\n        self.joint_pub = self.create_publisher(JointState, '/joint_commands', 10)\r\n\r\n        # PID gains for ankle control\r\n        self.kp = 2.0  # Proportional gain\r\n\r\n        self.get_logger().info('Balance Controller started')\r\n\r\n    def imu_callback(self, msg):\r\n        # Extract pitch angle\r\n        qy = msg.orientation.y\r\n        qw = msg.orientation.w\r\n        pitch = math.asin(2 * (qw * qy))\r\n\r\n        # Calculate corrective ankle angle (proportional control)\r\n        ankle_correction = -self.kp * pitch\r\n\r\n        # Publish ankle command\r\n        cmd = JointState()\r\n        cmd.header.stamp = self.get_clock().now().to_msg()\r\n        cmd.name = ['left_ankle_pitch', 'right_ankle_pitch']\r\n        cmd.position = [ankle_correction, ankle_correction]\r\n\r\n        self.joint_pub.publish(cmd)\r\n\r\n        self.get_logger().info(\r\n            f'Pitch: {math.degrees(pitch):.2f}\xb0, Ankle correction: {math.degrees(ankle_correction):.2f}\xb0'\r\n        )\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = BalanceController()\r\n    rclpy.spin(node)\r\n    node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,t.jsx)(e.h3,{id:"step-3-run-and-test",children:"Step 3: Run and Test"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# Terminal 1: Start IMU simulator\r\npython3 imu_simulator.py\r\n\r\n# Terminal 2: Start balance controller\r\npython3 balance_controller.py\r\n\r\n# Terminal 3: Monitor joint commands\r\nros2 topic echo /joint_commands\n"})}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Checkpoint"}),": You should see the balance controller adjusting ankle angles in response to simulated IMU pitch angles. The corrections should be opposite to the tilt direction (negative feedback)."]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"challenge-test-your-understanding",children:"Challenge: Test Your Understanding"}),"\n",(0,t.jsx)(e.p,{children:"Try these exercises to reinforce your learning:"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Basic"}),": Modify the action server to accept a ",(0,t.jsx)(e.code,{children:"speed"})," parameter (m/s) in addition to distance."]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.em,{children:"Hint"}),": Add a field to the action goal and use it to adjust the ",(0,t.jsx)(e.code,{children:"cmd_vel.linear.x"})," value."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Intermediate"}),": Extend the balance controller to handle roll (left/right tilt) using ankle roll joints."]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.em,{children:"Hint"}),": Extract roll from quaternion and apply corrections to ",(0,t.jsx)(e.code,{children:"left_ankle_roll"})," and ",(0,t.jsx)(e.code,{children:"right_ankle_roll"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Advanced"}),": Implement a force sensor subscriber that detects when the robot's feet lose contact with the ground and triggers an emergency stop."]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.em,{children:"Hint"}),": Subscribe to ",(0,t.jsx)(e.code,{children:"geometry_msgs/WrenchStamped"})," on ",(0,t.jsx)(e.code,{children:"/left_foot/force"})," and check if ",(0,t.jsx)(e.code,{children:"force.z < threshold"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Solutions"}),": Test your implementations by observing joint commands and system behavior under different IMU conditions."]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"summary",children:"Summary"}),"\n",(0,t.jsx)(e.p,{children:"In this chapter, you learned:"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"ROS 2 actions"}),": Goal-based behaviors with feedback for long-running tasks like walking and manipulation"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Joint state management"}),": Publishing and subscribing to ",(0,t.jsx)(e.code,{children:"sensor_msgs/JointState"})," for controlling humanoid joints"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Sensor integration"}),": Using IMU data (",(0,t.jsx)(e.code,{children:"sensor_msgs/Imu"}),") for balance monitoring and control"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"ros2_control framework"}),": Industry-standard controller management for complex robotic systems"]}),"\n"]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Key Commands"}),":"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:'ros2 action list                           # List all active action servers\r\nros2 action send_goal /action_name <type> "goal_yaml"  # Send action goal from CLI\r\nros2 topic echo /joint_states              # Monitor joint positions\r\nros2 control list_controllers              # List loaded controllers\r\nros2 control switch_controllers --start <name>  # Start a controller\n'})}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Core Concepts"}),":"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Action"}),": Three-part interface (goal, feedback, result) for long-running tasks"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"JointState"}),": Standard message for robot joint positions, velocities, and efforts"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"IMU"}),": Inertial Measurement Unit providing orientation and acceleration data for balance"]}),"\n"]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,t.jsx)(e.p,{children:"Official Documentation:"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://docs.ros.org/en/humble/Tutorials/Intermediate/Writing-an-Action-Server-Client/Py.html",children:"ROS 2 Actions Tutorial"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://control.ros.org/",children:"ros2_control Documentation"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://docs.ros2.org/latest/api/sensor_msgs/",children:"sensor_msgs Package Reference"})}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:"Tutorials and Examples:"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://github.com/ros-controls/ros2_control_demos",children:"ROS 2 Control Demos"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://github.com/pal-robotics",children:"Humanoid Controller Examples (PAL Robotics)"})}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:"Research Papers:"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:'"Humanoid Robot Control with ROS 2" - IEEE Robotics and Automation Magazine'}),"\n",(0,t.jsx)(e.li,{children:'"Real-time Balance Control for Bipedal Humanoids" - IROS 2023'}),"\n"]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsx)(e.p,{children:"You're now ready to move on to the next chapter!"}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Next Chapter"}),": ",(0,t.jsx)(e.a,{href:"/physical-ai-textbook/docs/module1-ros2/ch3-urdf-humanoids",children:"Chapter 1.3: URDF for Humanoid Robots"})]}),"\n",(0,t.jsx)(e.p,{children:"In the next chapter, you'll learn how to describe humanoid robot morphology using URDF (Unified Robot Description Format)\u2014defining links, joints, collision models, and visual meshes for simulation and motion planning."}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Optional Practice"}),":"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:'Implement a "reach to target" action server for a 7-DOF humanoid arm'}),"\n",(0,t.jsx)(e.li,{children:"Create a gait pattern generator that publishes full-body joint trajectories"}),"\n",(0,t.jsx)(e.li,{children:"Integrate force/torque sensors in wrists for contact-aware manipulation"}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(d,{...n})}):d(n)}},8453:(n,e,r)=>{r.d(e,{R:()=>i,x:()=>a});var s=r(6540);const t={},o=s.createContext(t);function i(n){const e=s.useContext(o);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:i(n.components),s.createElement(o.Provider,{value:e},n.children)}}}]);